<!-- Configuration Variables -->
<script>
  window.CONFIG = {
    VERSION: '4.9.32',
    GOOGLE_TAG_ID: 'AW-10965605193',
    NETLIFY_URL: 'https://matrix-config.netlify.app',
  };
</script>

<!-- Font Quality CSS -->
<style>
  * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
</style>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-10965605193"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', window.CONFIG.GOOGLE_TAG_ID);
</script>

<!-- Memberstack -->
<script 
  data-memberstack-app="app_clv5usm1y001b0sykc2z475ht"
  src="https://static.memberstack.com/scripts/v1/memberstack.js" 
  type="text/javascript">
</script>

<!-- Dynamic Script Loading with Netlify CDN -->
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const isDevelopment = window.location.hostname === 'matrix-mirrors.webflow.io';
    
    function getScriptUrl(filename) {
      if (isDevelopment) {
        // Development: Use localhost
        return `http://localhost:9000/${filename}`;
      } else {
        // Production: Use Netlify CDN (no version needed - auto-updates)
        return `${window.CONFIG.NETLIFY_URL}/${filename}`;
      }
    }

    function loadScript(src, onLoad) {
      const script = document.createElement('script');
      script.src = src;
      script.defer = true;
      script.onload = onLoad;
      script.onerror = function() {
        console.error(`Failed to load script: ${src}`);
      };
      document.head.appendChild(script);
    }

    // Configure pages script
    if (window.location.pathname.startsWith('/configure/')) {
      loadScript(getScriptUrl('main.build.js'), function() {
        console.log('✅ Matrix Config main script loaded successfully');
        // Optional: Dispatch custom event for other scripts to listen to
        window.dispatchEvent(new CustomEvent('matrixConfigLoaded', {
          detail: { script: 'main', version: window.CONFIG.VERSION }
        }));
      });
    }
    
    // Products page script
    else if (window.location.pathname === '/products') {
      loadScript(getScriptUrl('productsPage.build.js'), function() {
        console.log('✅ Matrix Config products script loaded successfully');
        // Optional: Dispatch custom event for other scripts to listen to
        window.dispatchEvent(new CustomEvent('matrixConfigLoaded', {
          detail: { script: 'products', version: window.CONFIG.VERSION }
        }));
      });
    }

    // Global error handler for script loading
    window.addEventListener('error', function(e) {
      if (e.target.tagName === 'SCRIPT' && e.target.src.includes(window.CONFIG.NETLIFY_URL)) {
        console.error('Matrix Config script error:', e);
        // Could implement additional error reporting here
      }
    });
  });
</script>

<!-- Third Party Scripts -->
<script async defer src="https://tools.luckyorange.com/core/lo.js?site-id=7332be52"></script>
<script async src="https://cdn.jsdelivr.net/npm/@finsweet/attributes-modal@1/modal.js"></script>
